name: Scanning for secrets in commits
on:
 pull_request:
    branches:
      - main
jobs:
  Scan_Secrets_in_commit:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
    - name: Secret Scanning
      uses: trufflesecurity/trufflehog@main
      with:
        extra_args: --no-verification
    - name: Capture and Display Annotations
      if: always() # Ensure this step runs even if the previous step fails
      run: |
        # Check for annotations generated by TruffleHog
        if [ -d $GITHUB_WORKSPACE/.github/annotations ]; then
          echo "Annotations Found:"
          for file in $GITHUB_WORKSPACE/.github/annotations/*; do
            echo "Annotation File: $file"
            cat "$file"
          done
        else
          echo "No annotations found."
        fi      
